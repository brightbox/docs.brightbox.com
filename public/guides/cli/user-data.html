<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>Brightbox - User Data</title>
    <link href="http://localhost:4000/stylesheets/0reset.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="http://localhost:4000/stylesheets/960_24_col.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="http://localhost:4000/stylesheets/main.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="http://localhost:4000/stylesheets/buttons.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="http://localhost:4000/stylesheets/tiptip.css" media="screen" rel="stylesheet" type="text/css" />       
    <link href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />

    <script src="/javascripts/head.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-3144138-4']);
        _gaq.push(['_setDomainName', 'docs.brightbox.com']);
        _gaq.push(['_trackPageview']);

        (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>
  </head>
<body class="community">

 <header>
   <nav>
  <div id="nav_inner" class="container_24">
    <div id="logo"><h1><a href="/">Brightbox</a></h1></div>

    <ul class="primary">
      
        <li>
          <a href="http://brightbox.com"><span>brightbox.com</span></a>
        </li>
      
    </ul>

  </div>
</nav>


   <div id="banner" >

      <div class="container_24 small" id="banner_inner">

          <div id="title">
            <h2>Documentation.</h2>
          </div>
      </div>

    </div><!-- /banner -->
</header>

<div id="main">
  <div class="content container_24">
    
      
      <div id="breadcrumbs">
        
        	<a href="/">Overview</a> 
        	<b>&rsaquo;</b> 
        
        	<a href="/guides.html">Guides</a> 
        	<b>&rsaquo;</b> 
        
        	<a href="/guides/cli.html">CLI</a> 
        	<b>&rsaquo;</b> 
        
        	<a href="/guides/cli/user-data.html">User Data</a> 
        	 
        
      </div>
      


    <h2>User Data</h2>
    
    <p>Every server has access to it&#8217;s own metadata via the EC2 compatible metadata_server. Data such as hostname, instance-id and ssh keys are available and can be used by scripts to configure the server on boot (this is how our default images install your ssh key on boot).</p>

<p>You can also provide your own custom user data when creating a server which can be used in any way you like. The only limitation is that it can&#8217;t be larger than 16k in size.</p>

<h2 id='hello_world_example'>Hello World example</h2>

<p>Firstly, create a new server with &#8220;hello world&#8221; as the user data. You can use any image, but I&#8217;m going to use Ubuntu Lucid:</p>

<pre><code>$ brightbox-servers create --user-data &quot;Hello World&quot; img-hm6oj
Creating a nano (typ-4nssg) server with image Ubuntu Lucid 10.04 server (img-hm6oj) with 0k of user data

 id         status    type  zone   created_on  image_id   cloud_ips  name
--------------------------------------------------------------------------
 srv-agvxl  creating  nano  gb1-b  2010-11-21  img-hm6oj                 
--------------------------------------------------------------------------</code></pre>

<p>Once it&#8217;s active, map a cloud IP to it:</p>

<pre><code>$ brightbox-cloudips map cip-3b0ha srv-agvxl
Mapping cip-3b0ha to interface int-nmgcx on srv-agvxl

 id         status  public_ip       server_id  interface_id  reverse_dns                         
--------------------------------------------------------------------------------------------------
 cip-3b0ha  mapped  109.107.35.239  srv-agvxl  int-nmgcx     cip-109-107-35-239.gb1.brightbox.com
--------------------------------------------------------------------------------------------------</code></pre>

<p>Then ssh in and grab the user data using curl:</p>

<pre><code>$ ssh ubuntu@public.srv-agvxl.gb1.brightbox.com
ubuntu@srv-agvxl:~$ curl http://169.254.169.254/latest/user-data
Hello World</code></pre>

<h2 id='usage_patterns'>Usage patterns</h2>

<p>The usual usage pattern for user data is to rig up an image to grab the data on boot and do something with it. You could set a bash script as the user data and execute it on boot, or you could put your puppet or chef server IP address in the user data field and use it on boot for registering your new node.</p>

<h2 id='ubuntu_cloudinit_support'>Ubuntu cloud-init support</h2>

<p>Our official Ubuntu images are pre-installed with the cloud-init package, which runs on boot and can be controlled in different ways via the user data. Full documentation on what cloud-init can do is available on the Ubuntu wiki, but here&#8217;s a neat example of it&#8217;s shell script support.</p>

<h3 id='basic_ubuntu_cloudinit_example'>Basic Ubuntu cloud-init example</h3>

<p>Firstly, create a shell script we want to run on boot. In this case we want to install a web server and generate a page to serve:</p>

<pre><code>$ cat &gt; ud-test-script.sh &lt;&lt;EOF
#!/bin/sh
apt-get update
apt-get install -qy nginx
invoke-rc.d nginx start
echo &quot;Hello from the Brightbox Cloud at `date`&quot; &gt; /var/www/index.html
# Maverick and Lucid use different paths by default
cp /var/www/index.html /var/www/nginx-default/
EOF</code></pre>

<p>Then create a new server with an Ubuntu image, specifying the shell script as user data:</p>

<pre><code>$ brightbox-servers create --user-data-file ud-test-script.sh img-9vxqi
Creating a nano (typ-4nssg) server with image Ubuntu Maverick 10.10 server (img-9vxqi) with 0k of user data

 id         status    type  zone   created_on  image_id   cloud_ips  name
--------------------------------------------------------------------------
 srv-q1pj6  creating  nano  gb1-b  2010-11-21  img-9vxqi                 
--------------------------------------------------------------------------</code></pre>

<p>Once it&#8217;s active, map a cloud IP to it:</p>

<pre><code>$ brightbox-cloudips map cip-1um8s srv-q1pj6
Mapping cip-1um8s to interface int-1rb7h on srv-q1pj6

 id         status  public_ip       server_id  interface_id  reverse_dns                         
--------------------------------------------------------------------------------------------------
 cip-1um8s  mapped  109.107.35.140  srv-q1pj6  int-1rb7h     cip-109-107-35-140.gb1.brightbox.com
--------------------------------------------------------------------------------------------------</code></pre>

<p>Then load the web page to prove the script executed:</p>

<pre><code>$ curl public.srv-q1pj6.gb1.brightbox.com
Hello from the Brightbox Cloud at Sun Nov 21 21:19:12 GMT 2010</code></pre>
  </div><!-- /content -->
</div><!-- /main -->


<footer>
<div id="footer_inner" class="container_24">
  <div class="grid_9 alpha">
  <h4>Follow @brightbox</h4>  
    
  <p class="social">
    <a href="http://twitter.com/brightbox" title="Twitter (@brightbox)" class="tip"><img src="/images/icons/twitter.png" /></a> 
    <a href="http://facebook.com/brightbox" title="Facebook" class="tip"><img src="/images/icons/facebook.png" /></a> 
    <a href="http://flickr.com/brightbox" title="Flickr" class="tip"><img src="/images/icons/flickr.png" /></a> 
    <a href="http://github.com/brightbox" title="GitHub" class="tip"><img src="/images/icons/github.png" /></a> 
    <a href="http://youtube.com/brightbox" title="YouTube" class="tip"><img src="/images/icons/youtube.png" /></a> 
  </p>
    
   <form id="subscribe" action="http://brightbox.createsend.com/t/y/s/bykuul/" method="post">
     <label for="bykuul-bykuul">Receive email updates about new products, features and other news (unsubscribe anytime).</label>
     
      <p>
        <input type="text" name="cm-bykuul-bykuul" id="bykuul-bykuul" placeholder="your email" />
      <button type="submit">subscribe</button></p>
    </form>
    <p class="copyright">Copyright &copy; 2011 Brightbox Systems Ltd</p>
    <p class="links">
      <a href="/legal/terms">Terms &amp; Conditions</a> &bull; 
      <a href="https://api.gb1.brightbox.com/1.0/">API</a> &bull; 
      <a href="http://docs.brightbox.com">Documentation</a> &bull;
      <a href="/about/contact">Contact us</a>
    </p>
  </div>

  <div class="clear">.</div>

<a href="http://github.com/brightbox/brightbox-docs" target="_blank"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://a248.e.akamai.net/assets.github.com/img/e6bef7a091f5f3138b8cd40bc3e114258dd68ddf/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub"></a>
  
</div>
</footer>

   <script type="text/javascript">
    head.js(
     { 'before': '/javascripts/before.js' },
     { 'jquery': 'http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js' },
     { 'jquery.smooth-scroll': '/javascripts/jquery.smooth-scroll.min.js' },
     { 'jquery.twitter': '/javascripts/jquery.twitter.js' },
     { 'jquery.tiptip': '/javascripts/jquery.tiptip.min.js' },
     { 'jquery.fancyzoom': '/javascripts/jquery.fancyzoom.js' },
     { 'disqus': 'http://brightbox.disqus.com/embed.js' },
     { 'jqueryui': 'http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.15/jquery-ui.min.js' },
  </script>
</body>
</html>
